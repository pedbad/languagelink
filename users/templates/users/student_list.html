{% extends 'core/base.html' %}
{% load static %}

{% block content %}
<div class="px-4 sm:px-6 lg:px-8 pb-16">
  <div class="sm:flex sm:items-center">
    <div class="sm:flex-auto">
      <h1 class="text-3xl font-extralight text-gray-900 sm:text-4xl">List of Students</h1>
      <p class="mt-2 text-sm text-gray-700">
        A list of all registered students.
      </p>
    </div>
    <div class="mt-4 sm:ml-16 sm:mt-0 sm:flex-none">
      <a href="{% url 'register' %}" 
        class="block rounded-md bg-deep-teal px-3 py-2 text-center text-sm font-semibold text-white shadow-sm hover:bg-teal-600 flex items-center justify-center">
        <!-- Student Icon -->
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5 mr-2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 6a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0ZM4.501 20.118a7.5 7.5 0 0 1 14.998 0A17.933 17.933 0 0 1 12 21.75c-2.676 0-5.216-.584-7.499-1.632Z" />
        </svg>
        Add New Student
      </a>
    </div>
  </div>

  <hr class="my-4 border-1 border-primary-dark-teal"> <!-- Divider after heading section -->

  <div class="-mx-4 mt-8 sm:-mx-6 lg:-mx-8">
    <div class="inline-block min-w-full py-2 align-middle sm:px-6 lg:px-8">

      

      <!-- Search Form -->
      <form id="search-form" method="GET" action="{% url 'teacher_student_list' %}" class="relative flex-auto mb-4">
        <!-- Search Input -->
        <input
          id="search-input"
          type="search"
          name="search"
          aria-label="Search students"
          placeholder="Search students by name, email, or date..."
          class="block w-full appearance-none rounded-lg bg-white border border-gray-300 py-2.5 pl-10 pr-4 text-sm text-gray-900 placeholder-gray-400 focus:ring-primary-dark-teal focus:border-primary-dark-teal"
          value="{{ request.GET.search }}"
        >
        <!-- Magnifying Glass Icon -->
        <svg
          xmlns="http://www.w3.org/2000/svg"
          viewBox="0 0 20 20"
          aria-hidden="true"
          class="pointer-events-none absolute top-[45%] left-3 h-5 w-5 transform -translate-y-1/2 text-gray-500"
        >
          <path d="M16.72 17.78a.75.75 0 1 0 1.06-1.06l-1.06 1.06ZM9 14.5A5.5 5.5 0 0 1 3.5 9H2a7 7 0 0 0 7 7v-1.5ZM3.5 9A5.5 5.5 0 0 1 9 3.5V2a7 7 0 0 0-7 7h1.5ZM9 3.5A5.5 5.5 0 0 1 14.5 9H16a7 7 0 0 0-7-7v1.5Zm3.89 10.45 3.83 3.83 1.06-1.06-3.83-3.83-1.06 1.06ZM14.5 9a5.48 5.48 0 0 1-1.61 3.89l1.06 1.06A6.98 6.98 0 0 0 16 9h-1.5Zm-1.61 3.89A5.48 5.48 0 0 1 9 14.5V16a6.98 6.98 0 0 0 4.95-2.05l-1.06-1.06Z" />
        </svg>
      </form>
      
      <table class="min-w-full divide-y divide-gray-300">
        <thead class="bg-neutral-gray-brown text-white">
          <tr>
            <!-- Avatar Column -->
            <th scope="col" class="py-4 px-4 text-center text-base font-semibold sm:pl-0">
              <span class="sr-only">Avatar</span>
            </th>
        
            <!-- First Name Column -->
            <th scope="col" class="py-3.5 px-3 text-left text-sm font-semibold">
              <a href="?sort=first_name&order={% if current_sort == 'first_name' and current_order == 'asc' %}desc{% else %}asc{% endif %}"
                 class="flex items-center">
                First Name
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="white" class="w-4 h-4 ml-1">
                  {% if current_sort == 'first_name' %}
                    {% if current_order == 'asc' %}
                      <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m0 0-6-6m6 6 6-6" />
                    {% else %}
                      <path stroke-linecap="round" stroke-linejoin="round" d="M12 19.5v-15m0 0-6 6m6-6 6 6" />
                    {% endif %}
                  {% else %}
                    <path stroke-linecap="round" stroke-linejoin="round" d="M3 7.5 7.5 3m0 0L12 7.5M7.5 3v13.5m13.5 0L16.5 21m0 0L12 16.5m4.5 4.5V7.5" />
                  {% endif %}
                </svg>
              </a>
            </th>
        
            <!-- Last Name Column -->
            <th scope="col" class="py-3.5 px-3 text-left text-sm font-semibold">
              <a href="?sort=last_name&order={% if current_sort == 'last_name' and current_order == 'asc' %}desc{% else %}asc{% endif %}"
                 class="flex items-center">
                Last Name
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="white" class="w-4 h-4 ml-1">
                  {% if current_sort == 'last_name' %}
                    {% if current_order == 'asc' %}
                      <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m0 0-6-6m6 6 6-6" />
                    {% else %}
                      <path stroke-linecap="round" stroke-linejoin="round" d="M12 19.5v-15m0 0-6 6m6-6 6 6" />
                    {% endif %}
                  {% else %}
                    <path stroke-linecap="round" stroke-linejoin="round" d="M3 7.5 7.5 3m0 0L12 7.5M7.5 3v13.5m13.5 0L16.5 21m0 0L12 16.5m4.5 4.5V7.5" />
                  {% endif %}
                </svg>
              </a>
            </th>
        
            <!-- Email Column -->
            <th scope="col" class="py-3.5 px-3 text-left text-sm font-semibold">
              <a href="?sort=email&order={% if current_sort == 'email' and current_order == 'asc' %}desc{% else %}asc{% endif %}"
                 class="flex items-center">
                Email
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="white" class="w-4 h-4 ml-1">
                  {% if current_sort == 'email' %}
                    {% if current_order == 'asc' %}
                      <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m0 0-6-6m6 6 6-6" />
                    {% else %}
                      <path stroke-linecap="round" stroke-linejoin="round" d="M12 19.5v-15m0 0-6 6m6-6 6 6" />
                    {% endif %}
                  {% else %}
                    <path stroke-linecap="round" stroke-linejoin="round" d="M3 7.5 7.5 3m0 0L12 7.5M7.5 3v13.5m13.5 0L16.5 21m0 0L12 16.5m4.5 4.5V7.5" />
                  {% endif %}
                </svg>
              </a>
            </th>
        
            <!-- Questionnaire Column -->
            <th scope="col" class="py-3.5 px-3 text-left text-sm font-semibold">
              <a href="?sort=questionnaire_completed&order={% if current_sort == 'questionnaire_completed' and current_order == 'asc' %}desc{% else %}asc{% endif %}"
                 class="flex items-center">
                Questionnaire
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="white" class="w-4 h-4 ml-1">
                  {% if current_sort == 'questionnaire_completed' %}
                    {% if current_order == 'asc' %}
                      <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m0 0-6-6m6 6 6-6" />
                    {% else %}
                      <path stroke-linecap="round" stroke-linejoin="round" d="M12 19.5v-15m0 0-6 6m6-6 6 6" />
                    {% endif %}
                  {% else %}
                    <path stroke-linecap="round" stroke-linejoin="round" d="M3 7.5 7.5 3m0 0L12 7.5M7.5 3v13.5m13.5 0L16.5 21m0 0L12 16.5m4.5 4.5V7.5" />
                  {% endif %}
                </svg>
              </a>
            </th>

            <th scope="col" class="py-3.5 px-3 text-left text-sm font-semibold">
              <a href="?sort=date_joined&order={% if current_sort == 'date_joined' and current_order == 'asc' %}desc{% else %}asc{% endif %}"
                 class="flex items-center">
                Date Registered
                {% if current_sort == 'date_joined' %}
                  <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                       stroke="currentColor" class="w-4 h-4 ml-1">
                    {% if current_order == 'asc' %}
                    <path stroke-linecap="round" stroke-linejoin="round"
                          d="M12 4.5v15m0 0-6-6m6 6 6-6" />
                    {% else %}
                    <path stroke-linecap="round" stroke-linejoin="round"
                          d="M12 19.5v-15m0 0-6 6m6-6 6 6" />
                    {% endif %}
                  </svg>
                {% else %}
                  <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                       stroke="currentColor" class="w-4 h-4 ml-1">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M3 7.5 7.5 3m0 0L12 7.5M7.5 3v13.5m13.5 0L16.5 21m0 0L12 16.5m4.5 4.5V7.5" />
                  </svg>
                {% endif %}
              </a>
            </th>
                    
            <!-- Actions Column -->
            <th scope="col" class="py-4 px-4 text-center text-base font-semibold">
              <span class="sr-only">Actions</span>
            </th>
          </tr>
        </thead>
        
        <tbody class="divide-y divide-gray-200 bg-white">
          {% for student in page_obj %}
          <tr class="hover:bg-gray-50">
            <!-- Avatar Column -->
            <td class="whitespace-nowrap py-4 px-4 text-sm font-medium text-gray-900 text-center">
              <div class="flex items-center justify-center">
                {% if student.studentprofile.profile_picture %}
                <img src="{{ student.studentprofile.profile_picture.url }}" alt="{{ student.email }}" class="h-10 w-10 rounded-full">
                {% else %}
                  <!-- Display Placeholder Image -->
                  <img src="{% static 'core/img/default-profile.png' %}" alt="Default Avatar" class="h-10 w-10 rounded-full">
                {% endif %}
              </div>
            </td>
        
            <!-- First Name -->
            <td class="whitespace-nowrap px-3 py-4 text-sm text-gray-900">{{ student.first_name }}</td>
        
            <!-- Last Name -->
            <td class="whitespace-nowrap px-3 py-4 text-sm text-gray-900">{{ student.last_name }}</td>
        
            <!-- Email -->
            <td class="whitespace-nowrap px-3 py-4 text-sm text-gray-500">{{ student.email }}</td>
        
            <!-- Questionnaire Status -->
            <td class="whitespace-nowrap px-3 py-4 text-sm">
              {% if student.questionnaire_completed %}
                <a href="{% url 'student_questionnaire' student.id %}" 
                  class="inline-flex items-center rounded-md bg-green-100 px-2 py-1 text-xs font-medium text-green-800 hover:text-green-600">
                  <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4 mr-1">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M13.5 6H5.25A2.25 2.25 0 0 0 3 8.25v10.5A2.25 2.25 0 0 0 5.25 21h10.5A2.25 2.25 0 0 0 18 18.75V10.5m-10.5 6L21 3m0 0h-5.25M21 3v5.25" />
                  </svg>
                  Completed
                </a>
              {% else %}
                <span class="inline-flex items-center rounded-md bg-red-100 px-2 py-1 text-xs font-medium text-red-800">
                  Not Completed
                </span>
              {% endif %}
            </td>

            <!-- Date Registered -->
            <td class="whitespace-nowrap px-3 py-4 text-sm text-gray-500">
              {{ student.date_joined|date:"M d, Y" }}
            </td>
        
            <!-- Actions -->
            <td class="relative whitespace-nowrap py-4 px-4 text-right text-sm font-medium">
              <a href="{% url 'student_profile_admin' student.id %}" class="text-indigo-600 hover:text-indigo-900">
                Edit<span class="sr-only">, {{ student.first_name }}</span>
              </a>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>

  <div class="flex items-center justify-between mt-4">
    <!-- Pagination Button Group -->
    <div class="flex items-center space-x-1">
      <!-- Previous Button -->
      {% if page_obj.has_previous %}
      <a href="?page={{ page_obj.previous_page_number }}&search={{ request.GET.search|default:'' }}&sort={{ current_sort|default:'first_name' }}&order={{ current_order|default:'asc' }}&items_per_page={{ items_per_page|default:25 }}"
         class="px-3 py-2 border border-gray-300 rounded-l-md bg-white text-gray-500 hover:bg-gray-100">
        ← Previous
      </a>
      {% else %}
      <span class="px-3 py-2 border border-gray-300 rounded-l-md bg-gray-200 text-gray-400">← Previous</span>
      {% endif %}
  
      <!-- Page Numbers -->
      {% for page in page_obj.paginator.page_range %}
        {% if page == page_obj.number %}
        <span class="px-3 py-2 border border-gray-300 bg-indigo-100 text-indigo-600">{{ page }}</span>
        {% else %}
        <a href="?page={{ page }}&search={{ request.GET.search|default:'' }}&sort={{ current_sort|default:'first_name' }}&order={{ current_order|default:'asc' }}&items_per_page={{ items_per_page|default:25 }}"
           class="px-3 py-2 border border-gray-300 bg-white text-gray-500 hover:bg-gray-100">
          {{ page }}
        </a>
        {% endif %}
      {% endfor %}
  
      <!-- Next Button -->
      {% if page_obj.has_next %}
      <a href="?page={{ page_obj.next_page_number }}&search={{ request.GET.search|default:'' }}&sort={{ current_sort|default:'first_name' }}&order={{ current_order|default:'asc' }}&items_per_page={{ items_per_page|default:25 }}"
         class="px-3 py-2 border border-gray-300 rounded-r-md bg-white text-gray-500 hover:bg-gray-100">
        Next →
      </a>
      {% else %}
      <span class="px-3 py-2 border border-gray-300 rounded-r-md bg-gray-200 text-gray-400">Next →</span>
      {% endif %}
    </div>
  
    <!-- Items Per Page Dropdown -->
    <div class="flex items-center space-x-2 pb-16">
      <label for="items_per_page" class="text-sm font-medium text-gray-700">Show</label>
      <select id="items_per_page" name="items_per_page"
              class="rounded-md border-gray-300 text-sm px-4 py-2 h-10 focus:ring-primary-dark-teal focus:border-primary-dark-teal"
              onchange="window.location.href='?page=1&items_per_page=' + this.value + '&search={{ request.GET.search|default:'' }}&sort={{ current_sort|default:'first_name' }}&order={{ current_order|default:'asc' }}'">
        <option value="25" {% if items_per_page == 25 %}selected{% endif %}>25</option>
        <option value="50" {% if items_per_page == 50 %}selected{% endif %}>50</option>
        <option value="100" {% if items_per_page == 100 %}selected{% endif %}>100</option>
        <option value="250" {% if items_per_page == 250 %}selected{% endif %}>250</option>
        <option value="500" {% if items_per_page == 500 %}selected{% endif %}>500</option>
      </select>
      <span class="text-sm font-medium text-gray-700">Users</span>
    </div>
  </div>
  
</div>
{% endblock %}