{% extends 'core/base.html' %}
{% load static %}

{% block title %}Teacher Profile{% endblock %}

{% block content %}
<div class="container mx-auto mt-10">
  <h1 class="text-3xl font-extralight text-gray-900 sm:text-4xl text-center mb-6">Teacher Profile</h1>
  <hr class="my-4 border-1 border-primary-dark-teal">

  <div class="flex items-start space-x-6">
    <!-- Profile Picture -->
    <div class="bg-white shadow-md rounded-lg p-4 w-40">
      {% if teacher_profile.profile_picture %}
        <img src="{{ teacher_profile.profile_picture.url }}" alt="Profile Picture" class="h-32 w-32 object-cover rounded-full mx-auto">
      {% else %}
        <img src="{% static 'core/img/default-profile.png' %}" alt="Default Profile" class="h-32 w-32 object-cover rounded-full mx-auto">
      {% endif %}
    </div>

    <!-- Profile Details -->
    <div class="flex-1">
      <!-- Profile View Mode -->
      {% if not is_editing %}
        <div class="mt-6 flex">
            <a href="{% url 'teacher_availability' %}"
              class="flex items-center justify-center bg-vibrant-orange text-white px-4 py-2 mb-4 rounded-lg 
                      hover:bg-dark-orange focus:outline-none focus:ring-2 focus:ring-vibrant-orange focus:ring-opacity-50 w-full">
              <!-- Add `mr-2` so the icon and text have breathing room -->
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="h-5 w-5 mr-2">
                <path d="M6.75 2.25A.75.75 0 0 1 7.5 3v1.5h9V3A.75.75 0 0 1 18 3v1.5h.75a3 3 0 0 1 3 3v11.25a3 3 0 0 1-3 3H5.25a3 3 0 0 1-3-3V7.5a3 3 0 0 1 3-3H6V3a.75.75 0 0 1 .75-.75Zm13.5 9a1.5 1.5 0 0 0-1.5-1.5H5.25a1.5 1.5 0 0 0-1.5 1.5v7.5a1.5 1.5 0 0 0 1.5 1.5h13.5a1.5 1.5 0 0 0 1.5-1.5v-7.5Z" clip-rule="evenodd" />
                <!-- (Calendar icon path) -->
              </svg>
              Set Availibility
            </a>
          </div>

        <p class="text-lg"><strong>Name:</strong> {{ teacher_profile.user.first_name }} {{ teacher_profile.user.last_name }}</p>
        <p class="text-lg"><strong>Email:</strong> {{ teacher_profile.user.email }}</p>
        <hr class="my-4 border-1 border-primary-dark-teal">

        <p class="text-lg"><strong>Biography:</strong></p>
        {% if teacher_profile.biography %}
          <p class="text-gray-800">{{ teacher_profile.biography }}</p>
        {% else %}
          <p class="text-gray-500 italic">Not provided yet. You can edit your profile to add this information.</p>
        {% endif %}
        <hr class="my-4 border-1 border-primary-dark-teal">

        <!-- Hosting Availability -->
        <p class="text-lg"><strong>Hosting Availability:</strong></p>
        {% if teacher_profile.can_host_online or teacher_profile.can_host_in_person %}
          <p class="text-gray-800">
            {% if teacher_profile.can_host_online %}
              ✅ Available for online meetings
            {% endif %}
            {% if teacher_profile.can_host_in_person %}
              {% if teacher_profile.can_host_online %} | {% endif %}
              ✅ Available for In-Person Meetings
            {% endif %}
          </p>
        {% else %}
          <p class="text-red-600 font-semibold">❌ Not available for meetings</p>
        {% endif %}
        <hr class="my-4 border-1 border-primary-dark-teal">

        <!-- Advising Status -->
        <p class="text-lg"><strong>Advising Status:</strong></p>
        <div class="flex items-center space-x-2 {% if teacher_profile.is_active_advisor %}text-green-600{% else %}text-red-600{% endif %} font-semibold">
          {% if teacher_profile.is_active_advisor %}
            <!-- Heroicon Check Circle -->
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="h-5 w-5">
              <path stroke-linecap="round" stroke-linejoin="round" d="M9 12l2 2 4-4M21 12A9 9 0 1 1 12 3a9 9 0 0 1 9 9z"/>
            </svg>
            <span>Active</span>
          {% else %}
            <!-- Heroicon X Circle -->
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="h-5 w-5">
              <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12M21 12A9 9 0 1 1 12 3a9 9 0 0 1 9 9z"/>
            </svg>
            <span>Inactive</span>
          {% endif %}
        </div>
        <hr class="my-4 border-1 border-primary-dark-teal">

        <!-- Edit Button -->
        {% if request.user.role == 'teacher' and request.user.id == teacher_profile.user.id %}
          <a href="?edit=true" class="flex items-center justify-center bg-deep-teal text-white px-4 py-2 mb-20 rounded-lg hover:bg-teal-600 focus:outline-none focus:ring-2 focus:ring-primary-dark-teal focus:ring-opacity-50 mt-4 w-full">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="h-5 w-5 mr-2">
              <path stroke-linecap="round" stroke-linejoin="round" d="m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 16.07a4.5 4.5 0 0 1-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 0 1 1.13-1.897l8.932-8.931Zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0 1 15.75 21H5.25A2.25 2.25 0 0 1 3 18.75V8.25A2.25 2.25 0 0 1 5.25 6H10"></path>
            </svg>
            <span>Edit Profile</span>
          </a>
        {% endif %}
      {% else %}
      
      <!-- Profile EDIT MODE FORM -->
        <form method="POST" enctype="multipart/form-data" class="mb-10">
          {% csrf_token %}

          <!-- First Name -->
          <div class="mb-6">
            <label class="block text-sm font-medium text-gray-700">First Name</label>
            <input type="text" name="first_name" value="{{ form.first_name.value|default:'' }}" class="block w-full rounded-md border-gray-300">
          </div>

          <!-- Last Name -->
          <div class="mb-6">
            <label class="block text-sm font-medium text-gray-700">Last Name</label>
            <input type="text" name="last_name" value="{{ form.last_name.value|default:'' }}" class="block w-full rounded-md border-gray-300">
          </div>

          <!-- Email -->
          <div class="mb-6">
            <label class="block text-sm font-medium text-gray-700">Email</label>
            <input type="email" name="email" value="{{ form.email.value|default:'' }}" class="block w-full rounded-md border-gray-300">
          </div>

          <!-- Biography -->
          <div class="mb-6">
            <label class="block text-sm font-medium text-gray-700">Biography</label>
            <textarea name="biography" class="block w-full rounded-md border-gray-300">{{ form.biography.value|default:'' }}</textarea>
          </div>

          <hr class="my-4 border-1 border-primary-dark-teal"> <!-- Divider before Profile Picture -->

          <!-- Profile Picture Upload Section -->
          <div class="mb-6">
            <label for="id_profile_picture" class="block text-lg font-medium text-gray-700 mb-2">Profile Picture</label>

            <!-- Profile Picture Preview -->
            <div class="flex items-center space-x-4">
              <!-- Profile Picture Thumbnail -->
              <div class="w-16 h-16 rounded-full overflow-hidden border border-gray-300">
                <img id="profile-picture-preview" 
                  src="{% if teacher_profile.profile_picture %}{{ teacher_profile.profile_picture.url }}{% else %}{% static 'core/img/default-profile.png' %}{% endif %}" 
                  data-default-src="{% static 'core/img/default-profile.png' %}" 
                  alt="Current Profile Picture" 
                  class="object-cover w-full h-full">
              </div>

              <!-- Styled File Upload Button -->
              <div class="flex-1 relative">
                <!-- File Input -->
                <input type="file" id="id_profile_picture" name="profile_picture" class="hidden" onchange="updateFileName(); updateProfilePicturePreview();">

                <!-- Custom Button -->
                <label for="id_profile_picture"
                  class="inline-flex items-center bg-deep-teal text-white px-4 pb-[5px] pt-[6px] text-xs font-medium leading-normal rounded shadow-lg transition duration-150 ease-in-out hover:bg-teal-600 hover:shadow-md focus:bg-teal-600 focus:shadow-md focus:outline-none focus:ring-2 focus:ring-primary-dark-teal focus:ring-opacity-50 active:bg-teal-700 active:shadow-md motion-reduce:transition-none cursor-pointer">
                  <!-- Upload Icon -->
                  <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4 mr-2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5V20.25A2.25 2.25 0 005.25 22.5H18.75A2.25 2.25 0 0021 20.25V16.5M7.5 10.5L12 6M12 6L16.5 10.5M12 6V18" />
                  </svg>
                  Choose File
                </label>

                <!-- Display File Name -->
                <p id="file-name" class="text-sm text-gray-500 mt-1">
                  {% if teacher_profile.profile_picture %}
                    {{ teacher_profile.profile_picture.name }}
                  {% else %}
                    No file chosen
                  {% endif %}
                </p>
              </div>
            </div>

            <!-- Clear Current Picture -->
            {% if teacher_profile.profile_picture %}
              <div class="mt-4 flex items-center space-x-2">
                <input type="checkbox" id="clear_id_profile_picture" name="profile_picture-clear" class="form-checkbox h-5 w-5 text-deep-teal border-gray-300 rounded focus:ring-deep-teal">
                <label for="clear_id_profile_picture" class="text-sm text-gray-700">Clear Current Picture</label>
              </div>
            {% endif %}
          </div>

          <hr class="my-4 border-1 border-primary-dark-teal"> <!-- Divider after Profile picture -->
        
          <!-- In-Person Hosting Availability Toggle -->
          <div class="mb-6">
            <label class="block text-lg font-medium text-gray-700">In-Person Hosting Availability</label>

            <!-- Display Current Status -->
            <p class="text-gray-800 mb-2">
              Current Status: 
              <strong id="in-person-status-text" class="{% if teacher_profile.can_host_in_person %}text-[#10454F]{% else %}text-[#B02907]{% endif %}">
                {% if teacher_profile.can_host_in_person %} 
                  Available for in-person meetings 
                {% else %} 
                  Not available for in-person meetings 
                {% endif %}
              </strong>
            </p>

            <!-- Toggle Styled Button -->
            <label class="inline-flex items-center cursor-pointer">
              <input type="checkbox" name="can_host_in_person" id="can_host_in_person" class="hidden"
                {% if teacher_profile.can_host_in_person %}checked{% endif %}>

              <span id="in-person-toggle-label"
                class="flex items-center text-white text-sm font-medium px-5 py-2 rounded-lg shadow-md transition-all duration-200
                {% if teacher_profile.can_host_in_person %}
                  bg-[#B02907] hover:bg-[#992405] focus:ring-[#B02907]
                {% else %}
                  bg-[#10454F] hover:bg-[#0d3a45] focus:ring-[#10454F]
                {% endif %} focus:outline-none focus:ring-2 focus:ring-opacity-50">
                
                <!-- Hero Icon -->
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="h-5 w-5 mr-2">
                  {% if teacher_profile.can_host_in_person %}
                    <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"></path> <!-- ❌ X Icon (Disable) -->
                  {% else %}
                    <path stroke-linecap="round" stroke-linejoin="round" d="M5 12l5 5L19 7"></path> <!-- ✔ Checkmark Icon (Enable) -->
                  {% endif %}
                </svg>

                <span>
                  {% if teacher_profile.can_host_in_person %}
                    Disable In-Person Meetings
                  {% else %}
                    Enable In-Person Meetings
                  {% endif %}
                </span>
              </span>
            </label>
          </div>

          <hr class="my-4 border-1 border-primary-dark-teal"> <!-- Divider after Toggle -->
          
          <!-- Online Hosting Availability Toggle -->
          <div class="mb-6">
            <label class="block text-lg font-medium text-gray-700">Online Hosting Availability</label>

            <!-- Display Current Status -->
            <p class="text-gray-800 mb-2">
              Current Status: 
              <strong id="online-status-text" class="{% if teacher_profile.can_host_online %}text-[#10454F]{% else %}text-[#B02907]{% endif %}">
                {% if teacher_profile.can_host_online %} 
                  Available for online meetings 
                {% else %} 
                  Not available for online meetings 
                {% endif %}
              </strong>
            </p>

            <!-- Toggle Styled Button -->
            <label class="inline-flex items-center cursor-pointer">
              <input type="checkbox" name="can_host_online" id="can_host_online" class="hidden"
                {% if teacher_profile.can_host_online %}checked{% endif %}>

              <span id="online-toggle-label"
                class="flex items-center text-white text-sm font-medium px-5 py-2 rounded-lg shadow-md transition-all duration-200
                {% if teacher_profile.can_host_online %}
                  bg-[#B02907] hover:bg-[#992405] focus:ring-[#B02907]
                {% else %}
                  bg-[#10454F] hover:bg-[#0d3a45] focus:ring-[#10454F]
                {% endif %} focus:outline-none focus:ring-2 focus:ring-opacity-50">
                
                <!-- Hero Icon -->
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="h-5 w-5 mr-2">
                  {% if teacher_profile.can_host_online %}
                    <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"></path> <!-- ❌ X Icon (Disable) -->
                  {% else %}
                    <path stroke-linecap="round" stroke-linejoin="round" d="M5 12l5 5L19 7"></path> <!-- ✔ Checkmark Icon (Enable) -->
                  {% endif %}
                </svg>

                <span>
                  {% if teacher_profile.can_host_online %}
                    Disable Online Meetings
                  {% else %}
                    Enable Online Meetings
                  {% endif %}
                </span>
              </span>
            </label>
          </div>

          <hr class="my-4 border-1 border-primary-dark-teal"> <!-- Divider after Toggle -->
 
          <!-- Toggle Advising Status Section -->
          <div class="mb-6">
            <label class="block text-lg font-medium text-gray-700">Advising Status</label>

            <!-- Display Current Status -->
            <p class="text-gray-800 mb-2">
              Current Status: 
              <strong id="status-text" class="{% if teacher_profile.is_active_advisor %}text-[#10454F]{% else %}text-[#B02907]{% endif %}">
                {% if teacher_profile.is_active_advisor %} Active {% else %} Inactive {% endif %}
              </strong>
            </p>

            <!-- Toggle Checkbox Styled as Button -->
            <label class="inline-flex items-center cursor-pointer">
              <input type="checkbox" name="is_active_advisor" id="is_active_advisor" class="hidden"
                {% if teacher_profile.is_active_advisor %}checked{% endif %}>

              <span id="toggle-label"
                class="flex items-center text-white text-sm font-medium px-5 py-2 rounded-lg shadow-md transition-all duration-200
                {% if teacher_profile.is_active_advisor %}
                  bg-[#B02907] hover:bg-[#992405] focus:ring-[#B02907]
                {% else %}
                  bg-[#10454F] hover:bg-[#0d3a45] focus:ring-[#10454F]
                {% endif %} focus:outline-none focus:ring-2 focus:ring-opacity-50">
                
                <!-- Hero Icon -->
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="h-5 w-5 mr-2">
                  {% if teacher_profile.is_active_advisor %}
                    <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"></path> <!-- ❌ X Icon (Inactive) -->
                  {% else %}
                    <path stroke-linecap="round" stroke-linejoin="round" d="M5 12l5 5L19 7"></path> <!-- ✔ Checkmark Icon (Active) -->
                  {% endif %}
                </svg>

                <span>
                  {% if teacher_profile.is_active_advisor %}
                    Deactivate Advising
                  {% else %}
                    Activate Advising
                  {% endif %}
                </span>
              </span>
            </label>
          </div>

          <hr class="my-4 border-1 border-primary-dark-teal"> <!-- Divider after Toggle button -->

          <!-- Change Your Password Section -->
          <a href="{% url 'password_change' %}" 
            class="flex items-center justify-center bg-deep-teal text-white text-xs font-medium px-4 py-2 rounded-lg hover:bg-teal-600 focus:outline-none focus:ring-2 focus:ring-primary-dark-teal focus:ring-opacity-50 mt-4">
              <!-- Icon -->
              <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="h-5 w-5 mr-2">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L10.582 16.07a4.5 4.5 0 01-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 011.13-1.897l8.932-8.931zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0115.75 21H5.25A2.25 2.25 0 013 18.75V8.25A2.25 2.25 0 015.25 6H10"></path>
              </svg>
              <!-- Text -->
              <span>Change Your Password</span>
          </a>

          <!-- Save and Cancel Buttons -->
          <div class="mt-4 mb-28 flex justify-end space-x-4">
            <button type="submit" class="bg-warm-brown text-white px-6 py-2 rounded-lg hover:bg-dark-orange">
              Save Profile
            </button>
            <a href="{% url 'teacher_profile' %}" class="bg-gray-200 text-gray-800 px-6 py-2 rounded-lg hover:bg-gray-300">
              Cancel
            </a>
          </div>
        </form>
      {% endif %}
    </div>
    
  </div>
  
</div>
{% endblock %}