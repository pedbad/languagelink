{% extends 'core/base.html' %}
{% load static %}

{% block title %}Student Profile{% endblock %}

{% block content %}
<div class="container mx-auto mt-10">
  <h1 class="text-3xl font-extralight text-gray-900 sm:text-4xl text-center mb-6">Student Profile</h1>
  <hr class="my-4 border-1 border-primary-dark-teal"> <!-- Divider after Welcome Message -->

  <!-- Flex Container for Profile Image and Info -->
  <div class="flex items-start space-x-6">
    <!-- Profile Image Placeholder or Uploaded Image -->
    <div class="bg-white shadow-md rounded-lg p-4 w-40 
      {% if is_student and has_completed_questionnaire and not is_editing %}
        mt-6
      {% endif %}">
      {% if student_profile.profile_picture %}
        <img src="{{ student_profile.profile_picture.url }}" alt="Profile Picture" class="h-32 w-32 object-cover rounded-full mx-auto">
      {% else %}
        <img src="{% static 'core/img/default-profile.png' %}" alt="Default Profile" class="h-32 w-32 object-cover rounded-full mx-auto">
      {% endif %}
    </div>

    <!-- Profile Details -->
    <div class="flex-1">
      {% if not is_editing %}
        {% if is_student and has_completed_questionnaire %}
          <div class="mt-6 flex">
            <a href="{% url 'student_booking_view' %}"
              class="flex items-center justify-center bg-vibrant-orange text-white px-4 py-2 mb-4 rounded-lg 
                      hover:bg-dark-orange focus:outline-none focus:ring-2 focus:ring-vibrant-orange focus:ring-opacity-50 w-full">
              <!-- Add `mr-2` so the icon and text have breathing room -->
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="h-5 w-5 mr-2">
                <path d="M6.75 2.25A.75.75 0 0 1 7.5 3v1.5h9V3A.75.75 0 0 1 18 3v1.5h.75a3 3 0 0 1 3 3v11.25a3 3 0 0 1-3 3H5.25a3 3 0 0 1-3-3V7.5a3 3 0 0 1 3-3H6V3a.75.75 0 0 1 .75-.75Zm13.5 9a1.5 1.5 0 0 0-1.5-1.5H5.25a1.5 1.5 0 0 0-1.5 1.5v7.5a1.5 1.5 0 0 0 1.5 1.5h13.5a1.5 1.5 0 0 0 1.5-1.5v-7.5Z" clip-rule="evenodd" />
                <!-- (Calendar icon path) -->
              </svg>
              Book a Meeting with an Advisor
            </a>
          </div>
        {% endif %}
        <!-- Name Section -->
        <p class="text-lg"><strong>Name:</strong> {{ student_profile.user.first_name }} {{ student_profile.user.last_name }}</p>

        <!-- Email Section -->
        <p class="text-lg"><strong>Email:</strong> {{ student_profile.user.email }}</p>
        
        <!-- Date Registered Section -->
        <p class="text-lg"><strong>Date Registered:</strong> {{ request.user.date_joined|date:"F j, Y" }}</p>
        
        <hr class="my-4 border-1 border-primary-dark-teal"> <!-- Divider after email -->

        <!-- Language Biography Section -->
        <p class="text-lg"><strong>Language Biography:</strong></p>
        {% if student_profile.biography %}
          <p class="text-gray-800">{{ student_profile.biography }}</p> <!-- Standard biography text -->
        {% else %}
          <p class="text-gray-500 italic">
            Not provided yet. Tell Us About Yourself! You can edit your profile to add this information.<br>
            Use this space to introduce yourself to your advisor. Here are some ideas to get you started:
            <ul class="list-disc pl-6 mt-2">
              <li><strong>Your Language Background:</strong> What languages do you already speak? Have you studied this language before?</li>
              <li><strong>Your Goals:</strong> Why are you learning this language? Are you preparing for a trip, an exam, or just learning for fun?</li>
              <li><strong>Your Interests:</strong> What topics do you enjoy talking about? (e.g., travel, food, music, culture).</li>
              <li><strong>Your Challenges:</strong> Are there specific areas you find difficult, like pronunciation, grammar, or vocabulary?</li>
              <li><strong>Your Learning Style:</strong> Do you prefer structured lessons, casual conversations, or something else?</li>
            </ul>
          </p>
        {% endif %}
        <hr class="my-4 border-1 border-primary-dark-teal"> <!-- Divider after language biography -->

        <!-- Languages of Interest Section -->
        <p class="text-lg"><strong>Languages of Interest:</strong></p>
        {% if student_profile.languages_of_interest %}
          <p class="text-gray-800">{{ student_profile.languages_of_interest }}</p> <!-- Standard text -->
        {% else %}
          <p class="text-gray-500 italic">
            Not provided yet. Tell us what languages you're interested in learning! You can edit your profile to add this information.
          </p>
        {% endif %}
        <hr class="my-4 border-1 border-primary-dark-teal"> <!-- Divider after Languages of Interest -->                


        <!-- Edit Profile Button Student only -->
        {% if request.user.role == 'student' and request.user.id == student_profile.user.id %}
          <a href="?edit=true" 
            class="flex items-center justify-center bg-deep-teal text-white px-4 py-2 mb-20 rounded-lg hover:bg-teal-600 focus:outline-none focus:ring-2 focus:ring-primary-dark-teal focus:ring-opacity-50 mt-4 w-full">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="h-5 w-5 mr-2">
              <path stroke-linecap="round" stroke-linejoin="round" d="m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 16.07a4.5 4.5 0 0 1-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 0 1 1.13-1.897l8.932-8.931Zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0 1 15.75 21H5.25A2.25 2.25 0 0 1 3 18.75V8.25A2.25 2.25 0 0 1 5.25 6H10" />
            </svg>
            <span>Edit Profile</span>
          </a>
        {% endif %}
        {% if request.user.role == 'admin' %}
          <div class="mt-4 flex justify-end space-x-4">
            <!-- Toggle Active Status Button -->
            <form method="POST" action="{% url 'toggle_student_active' student_profile.user.id %}">
              {% csrf_token %}
              <button type="submit" class="inline-flex items-center bg-warm-brown text-white px-6 py-2 text-sm font-medium leading-normal rounded-lg shadow-lg transition duration-150 ease-in-out hover:bg-dark-orange focus:bg-dark-orange focus:outline-none focus:ring-2 focus:ring-warm-brown focus:ring-opacity-50">
                <!-- Conditional Text -->
                {% if student_profile.user.is_active %}
                  <!-- Deactivate Icon -->
                  <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4 mr-2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                  </svg>
                  Deactivate Student
                {% else %}
                  <!-- Activate Icon -->
                  <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4 mr-2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" />
                  </svg>
                  Activate Student
                {% endif %}
              </button>
            </form>
            
            <!-- Delete Student Button -->
            <button 
              id="open-delete-modal" 
              type="button"
              class="inline-flex items-center bg-red-600 text-white px-4 py-2 text-sm font-medium rounded-lg shadow-lg hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500">
              Delete Student
            </button>

            <!-- Modal -->
            <div id="delete-modal" class="fixed top-0 left-0 w-screen h-screen z-50 hidden flex items-center justify-center bg-gray-500/75">
              <!-- Modal Content -->
              <div class="relative w-full max-w-lg mx-4 rounded-lg bg-white p-6 shadow-xl sm:p-8">
                
                <!-- Close Button -->
                <button id="close-delete-modal" type="button" 
                        class="absolute top-4 right-4 text-gray-400 hover:text-gray-600 focus:outline-none focus:ring-2 focus:ring-gray-300">
                  <span class="sr-only">Close</span>
                  <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                  </svg>
                </button>

                <!-- Modal Header -->
                <div class="flex items-center">
                  <div class="flex h-12 w-12 items-center justify-center rounded-full bg-red-100">
                    <svg class="h-6 w-6 text-red-600" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126ZM12 15.75h.007v.008H12v-.008Z" />
                    </svg>
                  </div>
                  <h3 class="ml-4 text-lg font-semibold text-gray-900">Delete Student</h3>
                </div>

                <!-- Modal Body -->
                <div class="mt-4">
                  <p class="text-sm text-gray-500">
                    Are you sure you want to delete this student? This action cannot be undone.
                  </p>
                </div>

                <!-- Modal Actions -->
                <div class="mt-6 flex justify-end space-x-3">
                  <form method="POST" action="{% url 'delete_student' student_profile.user.id %}">
                    {% csrf_token %}
                    <button type="submit" 
                            class="inline-flex items-center justify-center rounded-md bg-red-600 px-4 py-2 text-sm font-medium text-white shadow hover:bg-red-500 focus:outline-none focus:ring-2 focus:ring-red-500">
                      Delete
                    </button>
                  </form>
                  <button id="cancel-delete-modal" type="button" 
                          class="inline-flex items-center justify-center rounded-md bg-gray-200 px-4 py-2 text-sm font-medium text-gray-800 hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-gray-400">
                    Cancel
                  </button>
                </div>
              </div>
            </div>
          </div>
          <hr class="my-4 border-1 border-primary-dark-teal"> <!-- Dividerdelete button -->
        {% endif %}

        <!-- Back to Student List button for admins and teachers -->
        {% if request.user.role != 'student' %}
          <div class="mt-6 mb-20">
            <a href="{% url 'teacher_student_list' %}"
              class="flex items-center justify-center bg-deep-teal text-white px-4 py-2 rounded-lg hover:bg-teal-600 focus:outline-none focus:ring-2 focus:ring-primary-dark-teal focus:ring-opacity-50 w-full">
              <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="h-5 w-5 mr-2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 19.5L8.25 12l7.5-7.5" />
              </svg>
              Back to Student List
            </a>
          </div>
        {% endif %}
      {% else %}
        <!-- Display the form for editing -->
        <form method="POST" enctype="multipart/form-data" class="mb-10">
          {% csrf_token %}          
          <!-- First Name Field -->
          <div class="relative mb-6">
            <input type="text" name="first_name" id="id_first_name" value="{{ form.first_name.value|default:'' }}"
              class="peer block min-h-[auto] w-full rounded border-0 bg-white px-3 py-[0.32rem] leading-[2.15] outline-none transition-all duration-200 ease-linear placeholder-transparent peer-focus:text-primary peer-valid:text-primary dark:text-white dark:placeholder:text-neutral-300 dark:peer-focus:text-primary"
              placeholder="First Name" required />
            <label for="id_first_name"
              class="pointer-events-none absolute left-3 top-0 mb-0 origin-[0_0] truncate pt-[0.37rem] leading-[2.15] text-neutral-500 transition-all duration-200 ease-out peer-focus:-translate-y-[1.15rem] peer-focus:scale-[0.8] peer-valid:-translate-y-[1.15rem] peer-valid:scale-[0.8] dark:text-neutral-400 dark:peer-focus:text-primary">
              First Name
            </label>
          </div>

          <!-- Last Name Field -->
          <div class="relative mb-6">
            <input type="text" name="last_name" id="id_last_name"
              value="{{ form.last_name.value|default:'' }}"
              class="peer block min-h-[auto] w-full rounded border-0 bg-white px-3 py-[0.32rem] leading-[2.15] outline-none transition-all duration-200 ease-linear placeholder-transparent peer-focus:text-primary peer-valid:text-primary dark:text-white dark:placeholder:text-neutral-300 dark:peer-focus:text-primary"
              placeholder="Last Name" required />
            <label for="id_last_name"
              class="pointer-events-none absolute left-3 top-0 mb-0 max-w-[90%] origin-[0_0] truncate pt-[0.37rem] leading-[2.15] text-neutral-500 transition-all duration-200 ease-out peer-focus:-translate-y-[1.15rem] peer-focus:scale-[0.8] peer-valid:-translate-y-[1.15rem] peer-valid:scale-[0.8] dark:text-neutral-400 dark:peer-focus:text-primary">
              Last Name
            </label>
          </div>
          
          <!-- Email Field -->
          <div class="relative mb-6">
            <input type="email" name="email" id="id_email"
              value="{{ form.email.value|default:'' }}"
              class="peer block min-h-[auto] w-full rounded border-0 bg-white px-3 py-[0.32rem] leading-[2.15] outline-none transition-all duration-200 ease-linear placeholder-transparent peer-focus:text-primary peer-valid:text-primary dark:text-white dark:placeholder:text-neutral-300 dark:peer-focus:text-primary"
              placeholder="Email Address" required />
            <label for="id_email"
              class="pointer-events-none absolute left-3 top-0 mb-0 max-w-[90%] origin-[0_0] truncate pt-[0.37rem] leading-[2.15] text-neutral-500 transition-all duration-200 ease-out peer-focus:-translate-y-[1.15rem] peer-focus:scale-[0.8] peer-valid:-translate-y-[1.15rem] peer-valid:scale-[0.8] dark:text-neutral-400 dark:peer-focus:text-primary">
              Email Address
            </label>
          </div>

          <!-- Language Biography Field -->
          <div class="mb-6">
            <label for="id_biography" class="block text-sm font-medium text-gray-700 mb-1">Language Biography</label>
            <textarea name="biography" id="id_biography"
              class="block w-full h-32 rounded-md border border-gray-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
              placeholder="Tell Us About Yourself!">{{ form.biography.value|default:'' }}</textarea>
          </div>

          <!-- Languages of Interest Field -->
          <div class="mb-6">
            <label for="id_languages_of_interest" class="block text-sm font-medium text-gray-700 mb-1">Languages of Interest</label>
            <textarea name="languages_of_interest" id="id_languages_of_interest"
              class="block w-full h-32 rounded-md border border-gray-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
              placeholder="What languages are you interested in learning?">{{ form.languages_of_interest.value|default:'' }}</textarea>
          </div>

          <hr class="my-4 border-1 border-primary-dark-teal"> <!-- Divider after Languages of Interest -->

          <!-- Profile Picture Field -->
          <div class="mb-6">
            <label for="id_profile_picture" class="block text-lg font-medium text-gray-700 mb-2">Profile Picture</label>

            <!-- Profile Picture Preview -->
            <div class="flex items-center space-x-4">
              <!-- Profile Picture Thumbnail -->
              <div class="w-16 h-16 rounded-full overflow-hidden border border-gray-300">
                <img id="profile-picture-preview" 
                  src="{% if student_profile.profile_picture %}{{ student_profile.profile_picture.url }}{% else %}{% static 'core/img/default-profile.png' %}{% endif %}" 
                  data-default-src="{% static 'core/img/default-profile.png' %}" 
                  alt="Current Profile Picture" 
                  class="object-cover w-full h-full">
              </div>

              <!-- Styled File Upload Button -->
              <div class="flex-1 relative">
                <!-- File Input -->
                <input type="file" id="id_profile_picture" name="profile_picture" 
                      class="hidden" 
                      onchange="updateFileName(); updateProfilePicturePreview();">

                <!-- Custom Button -->
                <label for="id_profile_picture"
                  class="inline-flex items-center bg-deep-teal text-white px-4 pb-[5px] pt-[6px] text-xs font-medium leading-normal rounded shadow-lg transition duration-150 ease-in-out hover:bg-teal-600 hover:shadow-md focus:bg-teal-600 focus:shadow-md focus:outline-none focus:ring-2 focus:ring-primary-dark-teal focus:ring-opacity-50 active:bg-teal-700 active:shadow-md motion-reduce:transition-none">
                  <!-- Upload Icon -->
                  <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4 mr-2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5V20.25A2.25 2.25 0 005.25 22.5H18.75A2.25 2.25 0 0021 20.25V16.5M7.5 10.5L12 6M12 6L16.5 10.5M12 6V18" />
                  </svg>
                Choose File
                </label>


                <!-- Display File Name -->
                <p id="file-name" class="text-sm text-gray-500 mt-1">
                  {% if student_profile.profile_picture %}
                    {{ student_profile.profile_picture.name }}
                  {% else %}
                    No file chosen
                  {% endif %}
                </p>
              </div>
            </div>

            <!-- Clear Current Picture -->
            {% if student_profile.profile_picture %}
            <div class="mt-4 flex items-center space-x-2">
              <input type="checkbox" id="clear_id_profile_picture" name="profile_picture-clear" class="form-checkbox h-5 w-5 text-deep-teal border-gray-300 rounded focus:ring-deep-teal">
              <label for="clear_id_profile_picture" class="text-sm text-gray-700">Clear Current Picture</label>
            </div>
            {% endif %}
          </div>
          
          <hr class="my-4 border-1 border-primary-dark-teal"> <!-- Divider after Profile picture -->

          <a href="{% url 'password_change' %}" 
            class="flex items-center bg-deep-teal text-white text-xs font-medium px-4 py-2 rounded-lg hover:bg-teal-600 focus:outline-none focus:ring-2 focus:ring-primary-dark-teal focus:ring-opacity-50 mt-4">
              <!-- Icon -->
              <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="h-5 w-5 mr-2">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L10.582 16.07a4.5 4.5 0 01-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 011.13-1.897l8.932-8.931zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0115.75 21H5.25A2.25 2.25 0 013 18.75V8.25A2.25 2.25 0 015.25 6H10"></path>
              </svg>
              <!-- Text -->
              <span>Change Your Password</span>
          </a>

          
          <div class="mt-4 mb-28 flex justify-end space-x-4">
            <!-- Save Profile Button -->
            <button type="submit"
              class="inline-flex items-center bg-warm-brown text-white px-6 py-2 text-sm font-medium leading-normal rounded-lg shadow-lg transition duration-150 ease-in-out hover:bg-dark-orange focus:bg-dark-orange focus:outline-none focus:ring-2 focus:ring-warm-brown focus:ring-opacity-50">
              <!-- Save Icon -->
              <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4 mr-2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M5 12.5l4 4L19 7M5 12.5H4v5.25A2.25 2.25 0 006.25 20.5h11.5A2.25 2.25 0 0020 18.25V13h-1" />
              </svg>
              Save Profile
            </button>
          
            <a href="{% url 'student_profile' %}" 
              class="inline-flex items-center bg-gray-200 text-gray-800 px-6 py-2 text-sm font-medium leading-normal rounded-lg shadow-lg transition duration-150 ease-in-out hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-gray-400">
              Cancel
            </a>
          </div>
        </form>
      {% endif %}
    </div>
  </div>
</div> <!-- eof container -->
{% endblock %}
