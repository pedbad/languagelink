{# users/templates/users/partials/note_item.html #}
{% load static %}
<div id="note-{{ note.id }}" class="bg-white shadow rounded p-4 relative">
  {# === Delete trigger (only the teacher who wrote it) === #}
  {% if request.user.role == 'teacher' and request.user == note.author %}
    <div class="absolute top-2 right-2">
      <button
        id="open-delete-{{ note.id }}"
        type="button"
        class="btn-danger-sm flex items-center"
      >
        <!-- trash icon -->
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
             stroke-width="1.5" stroke="currentColor"
             class="w-5 h-5 mr-1">
          <path stroke-linecap="round" stroke-linejoin="round" fill-rule="evenodd"
                d="m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107
                   1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084
                   a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0
                   -3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1
                   3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0
                   -3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0
                   -7.5 0" clip-rule="evenodd"/>
        </svg>
        Delete
      </button>
    </div>

    {# === Confirmation modal (hidden by default) === #}
    <div
      id="delete-modal-{{ note.id }}"
      class="fixed top-0 left-0 w-screen h-screen z-50 hidden flex items-center justify-center bg-gray-500/75"
    >
      <div class="relative w-full max-w-lg mx-4 rounded-lg bg-white p-6 shadow-xl sm:p-8">

        <!-- Close “X” -->
        <button
          type="button"
          data-action="close"
          class="absolute top-4 right-4 text-gray-400 hover:text-gray-600 focus:outline-none focus:ring-2 focus:ring-gray-300"
        >
          <span class="sr-only">Close</span>
          <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24"
               stroke-width="1.5" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round"
                  d="M6 18L18 6M6 6l12 12" />
          </svg>
        </button>

        <!-- Header -->
        <div class="flex items-center">
          <div class="flex h-12 w-12 items-center justify-center rounded-full bg-red-100">
            <svg class="h-6 w-6 text-red-600" fill="none" viewBox="0 0 24 24"
                 stroke-width="1.5" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round"
                    d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71
                       c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5
                       -3.898 0L2.697 16.126ZM12 15.75h.007v.008H12v-.008Z"/>
            </svg>
          </div>
          <h3 class="ml-4 text-lg font-semibold text-gray-900">Delete Note</h3>
        </div>

        <!-- Body -->
        <div class="mt-4">
          <p class="text-sm text-gray-500">
            Are you sure you want to delete this note? This action cannot be undone.
          </p>
        </div>

        <!-- Actions: Cancel then Delete -->
        <div class="mt-6 flex justify-end space-x-3">
          <button
            type="button"
            data-action="close"
            class="btn-cancel"
          >Cancel</button>

          <button
            type="button"
            class="btn-danger"
            hx-delete="{% url 'delete_resource_note' note.id %}"
            hx-target="#note-{{ note.id }}"
            hx-swap="delete"
            hx-on="htmx:afterRequest: document
                     .getElementById('delete-modal-{{ note.id }}')
                     .classList.add('hidden')"
          >Delete</button>
        </div>
      </div>
    </div>
  {% endif %}


  {# === Avatar + content === #}
  <div class="flex space-x-4">
    {# Avatar column #}
    <div class="flex-shrink-0">
      {% if note.author.teacherprofile.profile_picture %}
        <img 
          src="{{ note.author.teacherprofile.profile_picture.url }}" 
          alt="{{ note.author.get_full_name }}" 
          class="h-12 w-12 rounded-full object-cover"
        >
      {% else %}
        <img 
          src="{% static 'core/img/default-profile.png' %}" 
          alt="Default avatar" 
          class="h-12 w-12 rounded-full object-cover"
        >
      {% endif %}
    </div>

    {# Text content column #}
    <div class="flex-1">
      <p class="text-sm text-gray-500 mb-4">
        by {{ note.author.get_full_name }} on {{ note.created_at|date:"F j, Y, H:i" }}
      </p>

      {% if note.title %}
        <h2 class="text-lg font-semibold mb-2">{{ note.title }}</h2>
      {% endif %}

      <div class="
          prose max-w-none
          prose-ul:list-disc prose-ol:list-decimal
          prose-ul:pl-6
          prose-a:text-blue-600 prose-a:underline
        ">
          <div class="note-content prose max-w-none">
            {{ note.content|safe }}
          </div>        
      </div>
    </div>
  </div>
</div>
