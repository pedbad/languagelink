{# booking/templates/booking/admin_bookings_list.html #}
{% extends "core/base.html" %}
{% block title %}All Booked Slots{% endblock %}
{% block content %}
  <h1
    class="text-3xl font-extralight text-gray-900 text-center mb-6">
    All Booked Slots
  </h1>
  <hr class="my-4 border-primary-dark-teal">

  <!-- Search Form -->
  <form id="search-form" 
        method="GET" 
        action="{% url 'admin_bookings_list' %}" 
        class="relative flex-auto mb-4">
    <!-- Search Input -->
    <input
      id="search-input"
      type="search"
      name="search"
      aria-label="Search students"
      placeholder="Search users by name, email, or date..."
      class="block w-full appearance-none rounded-lg bg-white border border-gray-300 py-2.5 pl-10 pr-4 text-sm text-gray-900 placeholder-gray-400 focus:ring-primary-dark-teal focus:border-primary-dark-teal"
      value="{{ request.GET.search }}"
    >
    <!-- Magnifying Glass Icon -->
    <svg
      xmlns="http://www.w3.org/2000/svg"
      viewBox="0 0 20 20"
      aria-hidden="true"
      class="pointer-events-none absolute top-[45%] left-3 h-5 w-5 transform -translate-y-1/2 text-gray-500"
    >
      <path d="M16.72 17.78a.75.75 0 1 0 1.06-1.06l-1.06 1.06ZM9 14.5A5.5 5.5 0 0 1 3.5 9H2a7 7 0 0 0 7 7v-1.5ZM3.5 9A5.5 5.5 0 0 1 9 3.5V2a7 7 0 0 0-7 7h1.5ZM9 3.5A5.5 5.5 0 0 1 14.5 9H16a7 7 0 0 0-7-7v1.5Zm3.89 10.45 3.83 3.83 1.06-1.06-3.83-3.83-1.06 1.06ZM14.5 9a5.48 5.48 0 0 1-1.61 3.89l1.06 1.06A6.98 6.98 0 0 0 16 9h-1.5Zm-1.61 3.89A5.48 5.48 0 0 1 9 14.5V16a6.98 6.98 0 0 0 4.95-2.05l-1.06-1.06Z" />
    </svg>
  </form>


  {% if bookings %}
    <div class="overflow-x-auto">
      <table class="min-w-full divide-y divide-gray-300">
        <thead class="bg-neutral-gray-brown text-white">
          <tr>
            {# Date / Time – sortable #}
            <th scope="col" class="py-3.5 px-3 text-center text-sm font-semibold">
              <a href="?sort=date&order={% if current_sort == 'date' and current_order == 'asc' %}desc{% else %}asc{% endif %}"
                class="inline-flex items-center justify-center">
                Date / Time
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                    stroke="white" stroke-width="1.5" class="w-4 h-4 ml-1">
                  {% if current_sort == 'date' %}
                    {% if current_order == 'asc' %}
                      <path stroke-linecap="round" stroke-linejoin="round"
                            d="M12 4.5v15m0 0-6-6m6 6 6-6" />
                    {% else %}
                      <path stroke-linecap="round" stroke-linejoin="round"
                            d="M12 19.5v-15m0 0-6 6m6-6 6 6" />
                    {% endif %}
                  {% else %}
                    <path stroke-linecap="round" stroke-linejoin="round"
                          d="M3 7.5 7.5 3m0 0L12 7.5M7.5 3v13.5m13.5 0L16.5 21m0 0L12 16.5m4.5 4.5V7.5" />
                  {% endif %}
                </svg>
              </a>
            </th>

            {# Advisor – sortable #}
            <th scope="col" class="py-3.5 px-3 text-center text-sm font-semibold">
              <a href="?sort=adv_name&order={% if current_sort == 'adv_name' and current_order == 'asc' %}desc{% else %}asc{% endif %}"
                class="inline-flex items-center justify-center">
                Advisor
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                    stroke="white" stroke-width="1.5" class="w-4 h-4 ml-1">
                  {% if current_sort == 'adv_name' %}
                    {% if current_order == 'asc' %}
                      <path stroke-linecap="round" stroke-linejoin="round"
                            d="M12 4.5v15m0 0-6-6m6 6 6-6" />
                    {% else %}
                      <path stroke-linecap="round" stroke-linejoin="round"
                            d="M12 19.5v-15m0 0-6 6m6-6 6 6" />
                    {% endif %}
                  {% else %}
                    <path stroke-linecap="round" stroke-linejoin="round"
                          d="M3 7.5 7.5 3m0 0L12 7.5M7.5 3v13.5m13.5 0L16.5 21m0 0L12 16.5m4.5 4.5V7.5" />
                  {% endif %}
                </svg>
              </a>
            </th>

            {# Student – sortable #}
            <th scope="col" class="py-3.5 px-3 text-center text-sm font-semibold">
              <a href="?sort=stu_name&order={% if current_sort == 'stu_name' and current_order == 'asc' %}desc{% else %}asc{% endif %}"
                class="inline-flex items-center justify-center">
                Student
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                    stroke="white" stroke-width="1.5" class="w-4 h-4 ml-1">
                  {% if current_sort == 'stu_name' %}
                    {% if current_order == 'asc' %}
                      <path stroke-linecap="round" stroke-linejoin="round"
                            d="M12 4.5v15m0 0-6-6m6 6 6-6" />
                    {% else %}
                      <path stroke-linecap="round" stroke-linejoin="round"
                            d="M12 19.5v-15m0 0-6 6m6-6 6 6" />
                    {% endif %}
                  {% else %}
                    <path stroke-linecap="round" stroke-linejoin="round"
                          d="M3 7.5 7.5 3m0 0L12 7.5M7.5 3v13.5m13.5 0L16.5 21m0 0L12 16.5m4.5 4.5V7.5" />
                  {% endif %}
                </svg>
              </a>
            </th>

            {# Message – not sortable #}
            <th scope="col" class="py-3.5 px-3 text-center text-sm font-semibold w-64">
              Message
            </th>

            {# Actions – centered #}
            <th scope="col" class="py-4 px-4 text-center text-base font-semibold">
              <span class="sr-only">Actions</span>
            </th>
          </tr>
        </thead>

        <tbody class="bg-white divide-y divide-gray-200">
          {% for b in bookings %}
          <tr class="hover:bg-gray-50">
            {# Date / Time #}
            <td class="px-4 py-4 whitespace-nowrap">
              <div class="flex flex-col">
                <!-- DATE LINE -->
                <span class="flex items-center text-lg text-warm-brown">
                  <!-- calendar icon -->
                  <svg xmlns="http://www.w3.org/2000/svg"
                      class="h-4 w-4 mr-1 text-warm-brown"
                      fill="currentColor"
                      viewBox="0 0 24 24">
                    <path d="M12.75 12.75a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0ZM7.5 15.75a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5ZM8.25 17.25a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0ZM9.75 15.75a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5ZM10.5 17.25a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0ZM12 15.75a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5ZM12.75 17.25a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0ZM14.25 15.75a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5ZM15 17.25a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0ZM16.5 15.75a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5ZM15 12.75a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0ZM16.5 13.5a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5Z" />
                    <path fill-rule="evenodd" d="M6.75 2.25A.75.75 0 0 1 7.5 3v1.5h9V3A.75.75 0 0 1 18 3v1.5h.75a3 3 0 0 1 3 3v11.25a3 3 0 0 1-3 3H5.25a3 3 0 0 1-3-3V7.5a3 3 0 0 1 3-3H6V3a.75.75 0 0 1 .75-.75Zm13.5 9a1.5 1.5 0 0 0-1.5-1.5H5.25a1.5 1.5 0 0 0-1.5 1.5v7.5a1.5 1.5 0 0 0 1.5 1.5h13.5a1.5 1.5 0 0 0 1.5-1.5v-7.5Z" clip-rule="evenodd" />
                  </svg>
                  {{ b.date|date:"F j, Y" }}
                </span>
                <!-- TIME LINE -->
                <span class="flex items-center text-sm text-gray-500">
                  <!-- clock icon -->
                  <svg xmlns="http://www.w3.org/2000/svg"
                      class="h-4 w-4 mr-1 text-warm-brown"
                      fill="currentColor"
                      viewBox="0 0 24 24">
                    <path fill-rule="evenodd" d="M12 2.25c-5.385 0-9.75 4.365-9.75 9.75s4.365 9.75 9.75 9.75 9.75-4.365 9.75-9.75S17.385 2.25 12 2.25ZM12.75 6a.75.75 0 0 0-1.5 0v6c0 .414.336.75.75.75h4.5a.75.75 0 0 0 0-1.5h-3.75V6Z" clip-rule="evenodd" />
                  </svg>
                  {{ b.start|time:"H:i" }} to {{ b.end|time:"H:i" }}
                </span>
              </div>
            </td>

            {# Advisor Column #}
            <td class="px-4 py-4 whitespace-nowrap">
              <div class="flex items-center space-x-3">
                <img src="{{ b.adv_avatar }}"
                     alt="{{ b.adv_name }} avatar"
                     class="h-8 w-8 rounded-full object-cover border" />
                <div>
                  <div class="font-medium text-gray-900">{{ b.adv_name }}</div>
                  <div class="text-sm text-gray-500 inline-flex items-center">
                    <!-- mail icon -->
                    <svg xmlns="http://www.w3.org/2000/svg"
                         class="h-4 w-4 mr-1 text-warm-brown"
                         fill="none" viewBox="0 0 24 24"
                         stroke="currentColor" stroke-width="1.5">
                      <path d="M1.5 8.67v8.58a3 3 0 0 0 3 3h15a3 3 0 0 0 3-3V8.67l-8.928 5.493a3 3 0 0 1-3.144 0L1.5 8.67Z" />
                      <path d="M22.5 6.908V6.75a3 3 0 0 0-3-3h-15a3 3 0 0 0-3 3v.158l9.714 5.978a1.5 1.5 0 0 0 1.572 0L22.5 6.908Z" />
                    </svg>
                    {{ b.adv_email }}
                  </div>
                </div>
              </div>
            </td>

            {# Student Column #}
            <td class="px-4 py-4 whitespace-nowrap">
              <div class="flex items-center space-x-3">
                <img src="{{ b.stu_avatar }}"
                     alt="{{ b.stu_name }} avatar"
                     class="h-8 w-8 rounded-full object-cover border" />
                <div>
                  <div class="font-medium text-gray-900">{{ b.stu_name }}</div>
                  <div class="text-sm text-gray-500 inline-flex items-center">
                    <!-- mail icon -->
                    <svg xmlns="http://www.w3.org/2000/svg"
                         class="h-4 w-4 mr-1 text-warm-brown"
                         fill="none" viewBox="0 0 24 24"
                         stroke="currentColor" stroke-width="1.5">
                      <path d="M1.5 8.67v8.58a3 3 0 0 0 3 3h15a3 3 0 0 0 3-3V8.67l-8.928 5.493a3 3 0 0 1-3.144 0L1.5 8.67Z" />
                      <path d="M22.5 6.908V6.75a3 3 0 0 0-3-3h-15a3 3 0 0 0-3 3v.158l9.714 5.978a1.5 1.5 0 0 0 1.572 0L22.5 6.908Z" />
                    </svg>
                    {{ b.stu_email }}
                  </div>
                </div>
              </div>
            </td>

            {# Message Column #}
            <td class="px-4 py-4 max-w-64 whitespace-normal break-words text-sm text-warm-brown">
              {% if b.message %}
              <div class="inline-flex items-center text-sm text-warm-brown">
                <!-- chat bubble icon -->
                <svg xmlns="http://www.w3.org/2000/svg"
                     class="h-4 w-4 mr-1"
                     fill="none" viewBox="0 0 24 24"
                     stroke="currentColor" stroke-width="1.5">
                  <path fill-rule="evenodd"
                        d="M4.848 2.771A49.144 49.144 0 0 1 12 2.25c2.43 0 4.817.178 7.152.52
                           1.978.292 3.348 2.024 3.348 3.97v6.02c0 1.946-1.37 3.678-3.348 3.97
                           -1.94.284-3.916.455-5.922.505a.39.39 0 0 0-.266.112L8.78 21.53A.75.75 0 0 1 7.5 21
                           v-3.955a48.842 48.842 0 0 1-2.652-.316c-1.978-.29-3.348-2.024-3.348-3.97V6.741
                           c0-1.946 1.37-3.68 3.348-3.97Z"
                        clip-rule="evenodd" />
                </svg>
                {{ b.message }}
              </div>
              {% endif %}
            </td>

            {# Actions Column #}
            <td class="px-4 py-4 whitespace-nowrap">
              <div class="flex flex-col items-center space-y-2">
                <!-- View Advisor (on top) -->
                <a href="{% url 'teacher_profile_admin' b.adv_id %}"
                  class="inline-flex items-center bg-deep-teal text-white px-2 py-1 text-xs font-medium rounded-md shadow hover:bg-teal-600">
                  <!-- advisor icon -->
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M12 15a3 3 0 1 0 0-6 3 3 0 0 0 0 6Z" />
                    <path fill-rule="evenodd"
                          d="M1.323 11.447C2.811 6.976 7.028 3.75 12.001 3.75
                            c4.97 0 9.185 3.223 10.675 7.69.12.362.12.752 0 1.113
                            -1.487 4.471-5.705 7.697-10.677 7.697-4.97 0-9.186-3.223
                            -10.675-7.69a1.762 1.762 0 0 1 0-1.113ZM17.25 12
                            a5.25 5.25 0 1 1-10.5 0 5.25 5.25 0 0 1 10.5 0Z"
                          clip-rule="evenodd" />
                  </svg>
                  View Advisor
                </a>

                <!-- View Student (below) -->
                <a href="{% url 'student_profile_admin' b.stu_id %}"
                  class="inline-flex items-center bg-warm-brown text-white px-2 py-1 text-xs font-medium rounded-md shadow hover:bg-dark-orange">
                  <!-- student icon -->
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M12 15a3 3 0 1 0 0-6 3 3 0 0 0 0 6Z" />
                    <path fill-rule="evenodd"
                          d="M1.323 11.447C2.811 6.976 7.028 3.75 12.001 3.75
                            c4.97 0 9.185 3.223 10.675 7.69.12.362.12.752 0 1.113
                            -1.487 4.471-5.705 7.697-10.677 7.697-4.97 0-9.186-3.223
                            -10.675-7.69a1.762 1.762 0 0 1 0-1.113ZM17.25 12
                            a5.25 5.25 0 1 1-10.5 0 5.25 5.25 0 0 1 10.5 0Z"
                          clip-rule="evenodd" />
                  </svg>
                  View Student
                </a>
              </div>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  {% else %}
    <p class="text-center text-gray-600">No bookings found.</p>
  {% endif %}

  <hr class="mt-6 mb-24 border-primary-dark-teal">
{% endblock %}





