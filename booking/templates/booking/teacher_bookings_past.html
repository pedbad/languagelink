{# booking/templates/booking/teacher_bookings_list.html #}
{% extends "core/base.html" %}
{% block title %}My Upcoming Booked Slots{% endblock %}

{% block content %}
  <h1 class="text-3xl font-extralight text-gray-900 sm:text-4xl text-center mb-6">
    Your Upcoming Booked Slots
  </h1>
  <hr class="my-4 border-1 border-primary-dark-teal">

  {% include "booking/partials/bookings_toggle.html" %}

  <!-- Search Form -->
  <form id="search-form"
        method="GET"
        action="{% url 'teacher_bookings_list' %}"
        class="relative flex-auto mb-4"
  >
    <!-- Search Input -->
    <input
      id="search-input"
      type="search"
      name="search"
      aria-label="Search students"
      placeholder="Search students by name, email, or date..."
      class="block w-full appearance-none rounded-lg bg-white border border-gray-300 py-2.5 pl-10 pr-4 text-sm text-gray-900 placeholder-gray-400 focus:ring-primary-dark-teal focus:border-primary-dark-teal"
      value="{{ request.GET.search }}"
    >
    <!-- Magnifying Glass Icon -->
    <svg
      xmlns="http://www.w3.org/2000/svg"
      viewBox="0 0 20 20"
      aria-hidden="true"
      class="pointer-events-none absolute top-[45%] left-3 h-5 w-5 transform -translate-y-1/2 text-gray-500"
    >
      <path d="M16.72 17.78a.75.75 0 1 0 1.06-1.06l-1.06 1.06ZM9 14.5A5.5 5.5 0 0 1 3.5 9H2a7 7 0 0 0 7 7v-1.5ZM3.5 9A5.5 5.5 0 0 1 9 3.5V2a7 7 0 0 0-7 7h1.5ZM9 3.5A5.5 5.5 0 0 1 14.5 9H16a7 7 0 0 0-7-7v1.5Zm3.89 10.45 3.83 3.83 1.06-1.06-3.83-3.83-1.06 1.06ZM14.5 9a5.48 5.48 0 0 1-1.61 3.89l1.06 1.06A6.98 6.98 0 0 0 16 9h-1.5Zm-1.61 3.89A5.48 5.48 0 0 1 9 14.5V16a6.98 6.98 0 0 0 4.95-2.05l-1.06-1.06Z" />
    </svg>
  </form>

  {% if bookings %}
    <ul class="space-y-4">
      {% for b in bookings %}
        <li class="w-11/12 mx-auto bg-white p-4 rounded shadow flex items-center space-x-4">
          <!-- Student Avatar -->
          <img src="{{ b.student_avatar }}"
               alt="Student avatar"
               class="h-12 w-12 rounded-full object-cover border" />

          <!-- Main block -->
          <div class="flex-1">
            <!-- Date/time -->
            <p class="text-xl text-warm-brown">
              {{ b.date|date:"F j, Y" }} – 
              {{ b.start_time|time:"H:i" }} to {{ b.end_time|time:"H:i" }}
            </p>

            <!-- Student name + email -->
            <p>
              <span class="text-lg font-medium">{{ b.student_name }}</span>
              <span class="inline-flex items-center text-sm text-gray-500 ml-4">
                <svg xmlns="http://www.w3.org/2000/svg"
                     class="h-4 w-4 mr-1 text-warm-brown"
                     fill="none" viewBox="0 0 24 24"
                     stroke="currentColor" stroke-width="1.5">
                  <path d="M1.5 8.67v8.58a3 3 0 0 0 3 3h15a3 3 0 0 0 3-3V8.67l-8.928 5.493a3 3 0 0 1-3.144 0L1.5 8.67Z" />
                  <path d="M22.5 6.908V6.75a3 3 0 0 0-3-3h-15a3 3 0 0 0-3 3v.158l9.714 5.978a1.5 1.5 0 0 0 1.572 0L22.5 6.908Z" />
                </svg>
                {{ b.student_email }}
              </span>
            </p>

            <!-- Optional message -->
            {% if b.student_message %}
              <hr class="mt-1 border-1 border-gray-50">
              <p class="mt-1 text-sm text-gray-700 inline-flex items-start space-x-2">
                <svg xmlns="http://www.w3.org/2000/svg"
                     class="h-4 w-4 flex-shrink-0 text-warm-brown"
                     fill="none" viewBox="0 0 24 24"
                     stroke="currentColor" stroke-width="1.5">
                  <path fill-rule="evenodd"
                        d="M4.848 2.771A49.144 49.144 0 0 1 12 2.25c2.43 0 4.817.178 7.152.52
                           1.978.292 3.348 2.024 3.348 3.97v6.02c0 1.946-1.37 3.678-3.348 3.97
                           -1.94.284-3.916.455-5.922.505a.39.39 0 0 0-.266.112L8.78 21.53A.75.75 0 0 1 7.5 21
                           v-3.955a48.842 48.842 0 0 1-2.652-.316c-1.978-.29-3.348-2.024-3.348-3.97V6.741
                           c0-1.946 1.37-3.68 3.348-3.97Z" clip-rule="evenodd" />
                </svg>
                <span>“{{ b.student_message }}”</span>
              </p>
            {% endif %}
          </div>

          <!-- “View Student” button -->
          <a href="{% url 'student_profile_admin' b.student_id %}"
             class="inline-flex items-center bg-warm-brown text-white px-3 py-1.5 text-sm font-medium rounded-lg shadow-lg
                    transition duration-150 ease-in-out hover:bg-dark-orange focus:outline-none focus:ring-2 focus:ring-warm-brown focus:ring-opacity-50">
            <svg xmlns="http://www.w3.org/2000/svg"
                 fill="currentColor" viewBox="0 0 24 24"
                 class="h-5 w-5 mr-2">
              <path d="M12 15a3 3 0 1 0 0-6 3 3 0 0 0 0 6Z" />
              <path fill-rule="evenodd"
                    d="M1.323 11.447C2.811 6.976 7.028 3.75 12.001 
                        3.75c4.97 0 9.185 3.223 10.675 7.69.12.362.12.752 
                        0 1.113-1.487 4.471-5.705 7.697-10.677 7.697-4.97 
                        0-9.186-3.223-10.675-7.69a1.762 1.762 0 0 1 
                        0-1.113ZM17.25 12a5.25 5.25 0 1 1-10.5 0 
                        5.25 5.25 0 0 1 10.5 0Z" clip-rule="evenodd" />
            </svg>
            View Student
          </a>
        </li>
      {% endfor %}
    </ul>
  {% else %}
    <p class="text-gray-600 text-center">You have no upcoming booked slots.</p>
  {% endif %}

  <hr class="my-6 border-1 border-primary-dark-teal">

  <div class="mt-6 mb-20 text-center">
    {% if request.user.role == 'admin' %}
      <a href="{% url 'admin_dashboard' %}" class="flex items-center justify-center bg-deep-teal text-white px-4 py-2 rounded-lg hover:bg-teal-600">
        <!-- Chevron left icon-->
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="h-5 w-5 mr-2">
          <path stroke-linecap="round" stroke-linejoin="round" d="m18.75 4.5-7.5 7.5 7.5 7.5m-6-15L5.25 12l7.5 7.5" />
        </svg>
        Back to Dashboard
      </a>
    {% elif request.user.role == 'teacher' %}
      <a href="{% url 'teacher_profile' %}" class="flex items-center justify-center bg-deep-teal text-white px-4 py-2 rounded-lg hover:bg-teal-600">
        <!-- Chevron left icon-->
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="h-5 w-5 mr-2">
          <path stroke-linecap="round" stroke-linejoin="round" d="m18.75 4.5-7.5 7.5 7.5 7.5m-6-15L5.25 12l7.5 7.5" />
        </svg>
        Back to Profile
      </a>
    {% endif %}
  </div>
{% endblock %}
